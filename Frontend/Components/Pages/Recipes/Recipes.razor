@page "/recipes"
@inject ItemService ItemService

@inject LoginService LoginService
@inject RecipeService RecipeService
@inject NavigationManager Navigation
@rendermode @(new InteractiveServerRenderMode(prerender: false))

@using Frontend.Components
@using Frontend.Components.Shared
@using Frontend.Service
@using Frontend.Models

@* <Navbar /> *@

<h3>View Recipes</h3>

 <div class="card-container">
            <div class="card-body">
                @if(isLoading)
                {
                    <p>Loading Recipes...</p>
                }
                else if(!LoginService.IsAuthenticated)
                {
                    <p>Please <a href="/login">login</a> to see recipes</p>
                }

                else if(SuggestedRecipes is null || SuggestedRecipes.Count == 0)
                {
                <p>No ingredients! Time to go to Woolies!</p>
                <button class="btn" @onclick="@(() => Navigation.NavigateTo("/shoppinglist/view"))">Shopping</button>
                }
                else
                {
                    <h5>There are @SuggestedRecipes.Count recipes</h5>
                    <div id="display-recipes">
                    
                        @for (int i=0;i<SuggestedRecipes.Count;i++)
                        {
                            var sr = SuggestedRecipes[i];
                        
                            <div id="recipe">
                                <img class="recipe-img" src="@sr.ImageUrl" alt="@sr.Name" width="150" height="150" />
                                <span>@sr.Name (@sr.Category.ToString())</span>
                                @* <div>
                                 @foreach(var i in sr.Ingredients)
                                {
                                    <li>@i.Name</li>
                                }
                                </div>  *@
                                <h5>Description</h5>
                                <p>@sr.Description</p>
                            </div>
                        }
                       
                        
                    </div>
                    
                }
            </div>
</div>
<style>
#display-recipes{
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 20px;
    padding: 1rem;
   
}

#recipe{
    flex: 0 0 auto;
    scroll-snap-align: start;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 1rem;
    width: 200px;
    text-align: center;
    color:black;
    border-radius: 15px;
    border: 2px solid #000;
}
@* #recipe img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin-bottom: 0.5rem;
} *@
#recipe{
    display:flex;
    flex-direction: column;
    align-items: center;
    border: 1px solid #ccc;
    border-radius: 8px;
    color:black;
}
.recipe-img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin-bottom: 0.5rem;
}



</style>


@code {
    private List<Recipe> recipes = new List<Recipe>(); //all recipes
    private List<Recipe> SuggestedRecipes = new List<Recipe>(); //suggested Recipes based on current fridge stock    private bool isLoading = true;
    
    private bool isLoading = true;
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Console.WriteLine("Initializing Login Service...");
            await LoginService.InitializeAsync();
            
            if (LoginService.IsAuthenticated)
            {
                Console.WriteLine("Loading All Recipes...");
                await LoadAllRecipes();

                Console.WriteLine("Loading Suggested Recipes...");
                await LoadSuggestedRecipes();
            }
            
            isLoading = false;
            StateHasChanged();
        }
    }

    @* private string GetCategoryName(int category)
    {
        return category switch
        {
            0=> "Salad",
            1=> "Soup",
            2=> "Main",
            3=> "Side",
            4=> "Vegetarian",
            5=> "Dessert",
        };
    } *@
    private async Task LoadSuggestedRecipes(){
        int userId = LoginService.GetUserId();
        SuggestedRecipes = await RecipeService.GetSuggestedRecipes(userId);
    }
    private async Task LoadAllRecipes(){
        int userId = LoginService.GetUserId();
        recipes = await RecipeService.GetAllRecipes();
    }
}