@page "/login"
@inject LoginService loginService
@inject NavigationManager Navigation
@using Frontend.Models
@using Frontend.Service
@inject IJSRuntime JS;
@rendermode InteractiveServer

<h3>Welcome to IFridge</h3>
<div class="loginContainer"> @*Login form*@
<EditForm FormName="loginForm" Model="@model" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <div>
    <label class="form-label">ID</label>
    <InputText @bind-Value="model.loginId" class="form-control"/>
    </div>
    <div>
    <label class="form-label">PW</label>
    <InputText type="password" @bind-Value="model.pw" class="form-control"/>
    </div>
    <button type="submit" class="btn btn-primary">log in</button>
</EditForm>
    <div>
    <h4>New Here?</h4>
    <a href="/register">Sign-Up</a> 
    </div>
</div>

<style>
.loginContainer{
    width: 300px;
}
.loginContainer button{
    margin-top: 10px;
    margin-bottom:10px;
}
</style>
@code {
    [SupplyParameterFromForm]
    private LoginModel model{get;set;} = new();
    private string err = string.Empty;
    private async Task HandleLogin()
    {
        var success = await loginService.LoginAsync(model);
        if(success){
            Navigation.NavigateTo("/");
        }else{   
            err = "Invalid Id/pw";
            await JS.InvokeVoidAsync("alert",err); //alerts if user type wrong id/pw
        }
    }

    private void ClearForm() => model = new();
}
